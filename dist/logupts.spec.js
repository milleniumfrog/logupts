!function(e){var t={};function o(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=1)}([function(e,t,o){"use strict";o.r(t);const n=[{keys:["{{date}}"],replacer:()=>`${r(2,String((new Date).getDate()))}`,flags:"g"},{keys:["{{day}}"],replacer:()=>`${r(2,String((new Date).getDay()))}`,flags:"g"},{keys:["{{month}}"],replacer:()=>`${r(2,String((new Date).getMonth()+1))}`,flags:"g"},{keys:["{{year}}"],replacer:()=>`${(new Date).getFullYear()}`,flags:"g"},{keys:["{{hours}}"],replacer:()=>`${r(2,String((new Date).getHours()))}`,flags:"g"},{keys:["{{minutes}}"],replacer:()=>`${r(2,String((new Date).getMinutes()))}`,flags:"g"},{keys:["{{seconds}}"],replacer:()=>`${r(2,String((new Date).getSeconds()))}`,flags:"g"},{keys:["{{service}}"],replacer:(e,t)=>`[${t.service||"DEFAULT"}]`,flags:"g"}];function r(e,t){if(e<t.length)throw new Error("the message is longer than the wished length.");for(let o=t.length;o<e;++o)t="0"+t;return t}var i=o(3);o.d(t,"LogUpTs",function(){return c}),o.d(t,"DefaultPlaceholders",function(){return n});var s=function(e,t,o,n){return new(o||(o=Promise))(function(r,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function l(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){e.done?r(e.value):new o(function(t){t(e.value)}).then(s,l)}c((n=n.apply(e,t||[])).next())})};let l={prefix:"{{service}} ",postfix:"",placeholders:n,quiet:!1,transports:[],customFunctions:[],logType:"log",logStack:!0};class c{constructor(e){e=e||{},this.options={prefix:void 0!==e.prefix?e.prefix:l.prefix,postfix:void 0!==e.postfix?e.postfix:l.postfix,placeholders:void 0!==e.placeholders?e.placeholders:l.placeholders,quiet:void 0!==e.quiet?e.quiet:l.quiet,transports:void 0!==e.transports?e.transports:l.transports,customFunctions:void 0!==e.customFunctions?e.customFunctions:l.customFunctions,logType:void 0!==e.logType?e.logType:l.logType,logStack:void 0!==e.logStack?e.logStack:l.logStack},this.internals={service:"LOG"}}mergeOptions(e){return{prefix:void 0!==e.prefix?e.prefix:this.options.prefix,postfix:void 0!==e.postfix?e.postfix:this.options.postfix,placeholders:void 0!==e.placeholders?e.placeholders:this.options.placeholders,quiet:void 0!==e.quiet?e.quiet:this.options.quiet,transports:void 0!==e.transports?e.transports:this.options.transports,customFunctions:void 0!==e.customFunctions?e.customFunctions:this.options.customFunctions,logType:void 0!==e.logType?e.logType:this.options.logType,logStack:void 0!==e.logStack?e.logStack:this.options.logStack}}custom(e,t,o){return s(this,void 0,void 0,function*(){let n=this.mergeOptions(e);for(let e in t)this.internals[e]=t[e];let r=`${n.prefix}${o}${n.postfix}`;r=Object(i.a)(this.options.placeholders||[],r,this.internals);let s=[];for(let e of n.transports||[])s.push(e.exec(this.internals,r));for(let e of n.customFunctions||[])s.push(e(r,this.internals,n));return yield Promise.all(s),n.quiet||void 0===console[n.logType||"log"]||console[n.logType||"log"](r),r})}log(e,t){return s(this,void 0,void 0,function*(){return yield this.custom(t||{},{service:"LOG"},e)})}error(e,t){return s(this,void 0,void 0,function*(){let o=this.mergeOptions(t||{});o.logType="error";let n=e instanceof Error?`${e.message}${o.logStack&&void 0!==e.stack?"\n"+e.stack:""}`:e;return yield this.custom(o,{service:"ERROR"},n)})}}},function(e,t,o){"use strict";o.r(t);var n=o(0),r=function(e,t,o,n){return new(o||(o=Promise))(function(r,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function l(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){e.done?r(e.value):new o(function(t){t(e.value)}).then(s,l)}c((n=n.apply(e,t||[])).next())})};describe("test",()=>{it("log to console without Transport and customFunctions",()=>r(void 0,void 0,void 0,function*(){let e=new n.LogUpTs({quiet:!0}),t=yield e.log("hello");expect(t).toEqual("[LOG] hello"),e.options.prefix="{{year}} ",t=yield e.log("hello"),expect(t).toEqual("2018 hello")})),it("log error to console without Transport and customFunctions",()=>r(void 0,void 0,void 0,function*(){let e=yield new n.LogUpTs({quiet:!0,logStack:!1}).error(new Error("a Error happend"));expect(e).toEqual("Error")}))})},,function(e,t,o){"use strict";function n(e,t,o,n,r){n=n||"g";let i,s=new RegExp(e,n),l=0;for(;null!==(i=s.exec(t.slice(l)));)e=e.replace(new RegExp("\\\\","g"),""),t=t.replace(e,"function"==typeof o?o("",r):o),++l;return t}function r(e,t,o){for(let i of e)if(void 0===i.keys[1])t=!0!==i.called?n(i.keys[0],t,(e,t)=>i.replacer("",t),i.flags,o):t;else{let n=-1;for(let o of e){let e=new RegExp(o.keys[0],o.flags).exec(t);null!==e&&(n=n<e.index?e.index:n)}n>0&&(t=t.slice(0,n)+r(e,t.slice(n)));let s=new RegExp(i.keys[0],i.flags),l=s.exec(t);if(null!==l){let e=(s=new RegExp(i.keys[1],i.flags)).exec(t),n=[i.keys[0].replace(new RegExp("\\\\","g"),""),i.keys[1].replace(new RegExp("\\\\","g"),"")];null!==e&&(t=t.slice(0,l.index)+i.replacer(t.slice(l.index+n[0].length,e.index),o)+t.slice(e.index+n[1].length))}}return t}o.d(t,"b",function(){return n}),o.d(t,"a",function(){return r})}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL3BsYWNlaG9sZGVyLnRzIiwid2VicGFjazovLy8uL3NyYy9sb2d1cHRzLnRzIiwid2VicGFjazovLy8uL3NyYy9sb2d1cHRzLnNwZWMudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL3N0cnBsYWNlLnRzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJ0IiwibW9kZSIsIl9fZXNNb2R1bGUiLCJucyIsImNyZWF0ZSIsImtleSIsImJpbmQiLCJuIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwiRGVmYXVsdFBsYWNlaG9sZGVycyIsImtleXMiLCJyZXBsYWNlciIsImZpbGxTdHJXaXRoWmVyb3MiLCJTdHJpbmciLCJEYXRlIiwiZ2V0RGF0ZSIsImZsYWdzIiwiZ2V0RGF5IiwiZ2V0TW9udGgiLCJnZXRGdWxsWWVhciIsImdldEhvdXJzIiwiZ2V0TWludXRlcyIsImdldFNlY29uZHMiLCJub25lIiwicGFzc0FyZ3VtZW50cyIsInNlcnZpY2UiLCJsZW5ndGgiLCJtc2ciLCJFcnJvciIsIl9fd2VicGFja19leHBvcnRzX18iLCJfX2F3YWl0ZXIiLCJ0aGlzQXJnIiwiX2FyZ3VtZW50cyIsIlAiLCJnZW5lcmF0b3IiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImZ1bGZpbGxlZCIsInN0ZXAiLCJuZXh0IiwiZSIsInJlamVjdGVkIiwicmVzdWx0IiwiZG9uZSIsInRoZW4iLCJhcHBseSIsImRlZmF1bHRPcHRpb25zIiwicHJlZml4IiwicG9zdGZpeCIsInBsYWNlaG9sZGVycyIsInF1aWV0IiwidHJhbnNwb3J0cyIsImN1c3RvbUZ1bmN0aW9ucyIsImxvZ1R5cGUiLCJsb2dTdGFjayIsImxvZ3VwdHNfTG9nVXBUcyIsIltvYmplY3QgT2JqZWN0XSIsImN1c3RvbU9wdGlvbnMiLCJ0aGlzIiwib3B0aW9ucyIsInVuZGVmaW5lZCIsImludGVybmFscyIsInNldEludGVybmFscyIsIm1lc3NhZ2UiLCJvcHQiLCJtZXJnZU9wdGlvbnMiLCJzdHIiLCJzdHJwbGFjZSIsImFzeW5jVGhpbmdzIiwidHJhbnNwb3J0IiwicHVzaCIsImV4ZWMiLCJhc3luY0V4ZWMiLCJhbGwiLCJjb25zb2xlIiwiY3VzdG9tIiwiZXJyb3IiLCJzdGFjayIsIl9sb2d1cHRzX19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8wX18iLCJkZXNjcmliZSIsIml0IiwibG9nZ2VyIiwibG9nIiwiZXhwZWN0IiwidG9FcXVhbCIsInJlcGxhY2VTaW5nbGUiLCJzdHJpbmciLCJyZXBsYWNlQ29udGVudCIsInJlcyIsInJlZ2V4IiwiUmVnRXhwIiwiY291bnRlciIsInNsaWNlIiwicmVwbGFjZSIsInJlcGxhY2VDb21wbGV4IiwiY29tcGxleEtleXMiLCJjb21wbGV4IiwiY2FsbGVkIiwiYXJncyIsInRvUGFzcyIsIm1heEluZGV4IiwiaW5Db21wbGV4IiwiaW5kZXgiLCJyZXMxIiwicmVzMiIsInJlbW92ZUVzY2FwZXNGcm9tS2V5cyJdLCJtYXBwaW5ncyI6ImFBQ0EsSUFBQUEsS0FHQSxTQUFBQyxFQUFBQyxHQUdBLEdBQUFGLEVBQUFFLEdBQ0EsT0FBQUYsRUFBQUUsR0FBQUMsUUFHQSxJQUFBQyxFQUFBSixFQUFBRSxJQUNBRyxFQUFBSCxFQUNBSSxHQUFBLEVBQ0FILFlBVUEsT0FOQUksRUFBQUwsR0FBQU0sS0FBQUosRUFBQUQsUUFBQUMsSUFBQUQsUUFBQUYsR0FHQUcsRUFBQUUsR0FBQSxFQUdBRixFQUFB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LEtBQUEsR0FBQW9GLFFBQUEsSUFBQUgsT0FBQSxnQkFBQU0sRUFBQXZGLEtBQUEsR0FBQW9GLFFBQUEsSUFBQUgsT0FBQSxpQkFDQSxPQUFBYyxJQUVBbEIsSUFBQU0sTUFBQSxFQUFBVyxFQUFBRCxPQUFBTixFQUFBdEYsU0FBQTRFLEVBQUFNLE1BQUFXLEVBQUFELE1BQUFHLEVBQUEsR0FBQWhGLE9BQUErRSxFQUFBRixPQUFBL0UsR0FBQStELEVBQUFNLE1BQUFZLEVBQUFGLE1BQUFHLEVBQUEsR0FBQWhGLFVBS0EsT0FBQTZEIiwiZmlsZSI6ImxvZ3VwdHMuc3BlYy5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAxKTtcbiIsImV4cG9ydCBjb25zdCBEZWZhdWx0UGxhY2Vob2xkZXJzID0gW1xuICAgIC8vIGdldCBkYXkgMS0zMVxuICAgIHtcbiAgICAgICAga2V5czogWyd7e2RhdGV9fSddLFxuICAgICAgICByZXBsYWNlcjogKCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGAke2ZpbGxTdHJXaXRoWmVyb3MoMiwgU3RyaW5nKChuZXcgRGF0ZSgpKS5nZXREYXRlKCkpKX1gO1xuICAgICAgICB9LFxuICAgICAgICBmbGFnczogJ2cnXG4gICAgfSxcbiAgICB7XG4gICAgICAgIGtleXM6IFsne3tkYXl9fSddLFxuICAgICAgICByZXBsYWNlcjogKCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGAke2ZpbGxTdHJXaXRoWmVyb3MoMiwgU3RyaW5nKChuZXcgRGF0ZSgpKS5nZXREYXkoKSkpfWA7XG4gICAgICAgIH0sXG4gICAgICAgIGZsYWdzOiAnZydcbiAgICB9LFxuICAgIHtcbiAgICAgICAga2V5czogWyd7e21vbnRofX0nXSxcbiAgICAgICAgcmVwbGFjZXI6ICgpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBgJHtmaWxsU3RyV2l0aFplcm9zKDIsIFN0cmluZygobmV3IERhdGUoKSkuZ2V0TW9udGgoKSArIDEpKX1gO1xuICAgICAgICB9LFxuICAgICAgICBmbGFnczogJ2cnXG4gICAgfSxcbiAgICB7XG4gICAgICAgIGtleXM6IFsne3t5ZWFyfX0nXSxcbiAgICAgICAgcmVwbGFjZXI6ICgpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBgJHsobmV3IERhdGUoKSkuZ2V0RnVsbFllYXIoKX1gO1xuICAgICAgICB9LFxuICAgICAgICBmbGFnczogJ2cnXG4gICAgfSxcbiAgICB7XG4gICAgICAgIGtleXM6IFsne3tob3Vyc319J10sXG4gICAgICAgIHJlcGxhY2VyOiAoKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gYCR7ZmlsbFN0cldpdGhaZXJvcygyLCBTdHJpbmcoKG5ldyBEYXRlKCkpLmdldEhvdXJzKCkpKX1gO1xuICAgICAgICB9LFxuICAgICAgICBmbGFnczogJ2cnXG4gICAgfSxcbiAgICB7XG4gICAgICAgIGtleXM6IFsne3ttaW51dGVzfX0nXSxcbiAgICAgICAgcmVwbGFjZXI6ICgpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBgJHtmaWxsU3RyV2l0aFplcm9zKDIsIFN0cmluZygobmV3IERhdGUoKSkuZ2V0TWludXRlcygpKSl9YDtcbiAgICAgICAgfSxcbiAgICAgICAgZmxhZ3M6ICdnJ1xuICAgIH0sXG4gICAge1xuICAgICAgICBrZXlzOiBbJ3t7c2Vjb25kc319J10sXG4gICAgICAgIHJlcGxhY2VyOiAoKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gYCR7ZmlsbFN0cldpdGhaZXJvcygyLCBTdHJpbmcoKG5ldyBEYXRlKCkpLmdldFNlY29uZHMoKSkpfWA7XG4gICAgICAgIH0sXG4gICAgICAgIGZsYWdzOiAnZydcbiAgICB9LFxuICAgIHtcbiAgICAgICAga2V5czogWyd7e3NlcnZpY2V9fSddLFxuICAgICAgICByZXBsYWNlcjogKG5vbmUsIHBhc3NBcmd1bWVudHMpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBgWyR7cGFzc0FyZ3VtZW50cy5zZXJ2aWNlIHx8ICdERUZBVUxUJ31dYDtcbiAgICAgICAgfSxcbiAgICAgICAgZmxhZ3M6ICdnJ1xuICAgIH0sXG5dO1xuLyoqXG4gKiBmaWxsIHVwIGEgc3RyaW5nIHdpdGggemVyb3NcbiAqIEBwYXJhbSBsZW5ndGhcbiAqIEBwYXJhbSBtc2dcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGZpbGxTdHJXaXRoWmVyb3MobGVuZ3RoLCBtc2cpIHtcbiAgICBpZiAobGVuZ3RoIDwgbXNnLmxlbmd0aCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3RoZSBtZXNzYWdlIGlzIGxvbmdlciB0aGFuIHRoZSB3aXNoZWQgbGVuZ3RoLicpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgZm9yIChsZXQgaSA9IG1zZy5sZW5ndGg7IGkgPCBsZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgbXNnID0gJzAnICsgbXNnO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBtc2c7XG59XG4iLCJ2YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHJlc3VsdC52YWx1ZSk7IH0pLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbmltcG9ydCB7IERlZmF1bHRQbGFjZWhvbGRlcnMgfSBmcm9tICcuL3BsYWNlaG9sZGVyJztcbmltcG9ydCB7IHJlcGxhY2VDb21wbGV4IH0gZnJvbSAnLi9zdHJwbGFjZSc7XG5leHBvcnQgeyBEZWZhdWx0UGxhY2Vob2xkZXJzIH0gZnJvbSAnLi9wbGFjZWhvbGRlcic7XG5sZXQgZGVmYXVsdE9wdGlvbnMgPSB7XG4gICAgcHJlZml4OiAne3tzZXJ2aWNlfX0gJyxcbiAgICBwb3N0Zml4OiAnJyxcbiAgICBwbGFjZWhvbGRlcnM6IERlZmF1bHRQbGFjZWhvbGRlcnMsXG4gICAgcXVpZXQ6IGZhbHNlLFxuICAgIHRyYW5zcG9ydHM6IFtdLFxuICAgIGN1c3RvbUZ1bmN0aW9uczogW10sXG4gICAgbG9nVHlwZTogJ2xvZycsXG4gICAgbG9nU3RhY2s6IHRydWUsXG59O1xuZXhwb3J0IGNsYXNzIExvZ1VwVHMge1xuICAgIGNvbnN0cnVjdG9yKGN1c3RvbU9wdGlvbnMpIHtcbiAgICAgICAgY3VzdG9tT3B0aW9ucyA9IGN1c3RvbU9wdGlvbnMgfHwge307XG4gICAgICAgIC8vIHNldCBsb2d1cHRzb3B0aW9uc1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSB7XG4gICAgICAgICAgICBwcmVmaXg6IGN1c3RvbU9wdGlvbnMucHJlZml4ICE9PSB1bmRlZmluZWQgPyBjdXN0b21PcHRpb25zLnByZWZpeCA6IGRlZmF1bHRPcHRpb25zLnByZWZpeCxcbiAgICAgICAgICAgIHBvc3RmaXg6IGN1c3RvbU9wdGlvbnMucG9zdGZpeCAhPT0gdW5kZWZpbmVkID8gY3VzdG9tT3B0aW9ucy5wb3N0Zml4IDogZGVmYXVsdE9wdGlvbnMucG9zdGZpeCxcbiAgICAgICAgICAgIHBsYWNlaG9sZGVyczogY3VzdG9tT3B0aW9ucy5wbGFjZWhvbGRlcnMgIT09IHVuZGVmaW5lZCA/IGN1c3RvbU9wdGlvbnMucGxhY2Vob2xkZXJzIDogZGVmYXVsdE9wdGlvbnMucGxhY2Vob2xkZXJzLFxuICAgICAgICAgICAgcXVpZXQ6IGN1c3RvbU9wdGlvbnMucXVpZXQgIT09IHVuZGVmaW5lZCA/IGN1c3RvbU9wdGlvbnMucXVpZXQgOiBkZWZhdWx0T3B0aW9ucy5xdWlldCxcbiAgICAgICAgICAgIHRyYW5zcG9ydHM6IGN1c3RvbU9wdGlvbnMudHJhbnNwb3J0cyAhPT0gdW5kZWZpbmVkID8gY3VzdG9tT3B0aW9ucy50cmFuc3BvcnRzIDogZGVmYXVsdE9wdGlvbnMudHJhbnNwb3J0cyxcbiAgICAgICAgICAgIGN1c3RvbUZ1bmN0aW9uczogY3VzdG9tT3B0aW9ucy5jdXN0b21GdW5jdGlvbnMgIT09IHVuZGVmaW5lZCA/IGN1c3RvbU9wdGlvbnMuY3VzdG9tRnVuY3Rpb25zIDogZGVmYXVsdE9wdGlvbnMuY3VzdG9tRnVuY3Rpb25zLFxuICAgICAgICAgICAgbG9nVHlwZTogY3VzdG9tT3B0aW9ucy5sb2dUeXBlICE9PSB1bmRlZmluZWQgPyBjdXN0b21PcHRpb25zLmxvZ1R5cGUgOiBkZWZhdWx0T3B0aW9ucy5sb2dUeXBlLFxuICAgICAgICAgICAgbG9nU3RhY2s6IGN1c3RvbU9wdGlvbnMubG9nU3RhY2sgIT09IHVuZGVmaW5lZCA/IGN1c3RvbU9wdGlvbnMubG9nU3RhY2sgOiBkZWZhdWx0T3B0aW9ucy5sb2dTdGFjayxcbiAgICAgICAgfTtcbiAgICAgICAgLy8gc2V0IGRlZmF1bHRpbnRlcm5hbHNcbiAgICAgICAgdGhpcy5pbnRlcm5hbHMgPSB7XG4gICAgICAgICAgICBzZXJ2aWNlOiAnTE9HJ1xuICAgICAgICB9O1xuICAgIH1cbiAgICBtZXJnZU9wdGlvbnMoY3VzdG9tT3B0aW9ucykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcHJlZml4OiBjdXN0b21PcHRpb25zLnByZWZpeCAhPT0gdW5kZWZpbmVkID8gY3VzdG9tT3B0aW9ucy5wcmVmaXggOiB0aGlzLm9wdGlvbnMucHJlZml4LFxuICAgICAgICAgICAgcG9zdGZpeDogY3VzdG9tT3B0aW9ucy5wb3N0Zml4ICE9PSB1bmRlZmluZWQgPyBjdXN0b21PcHRpb25zLnBvc3RmaXggOiB0aGlzLm9wdGlvbnMucG9zdGZpeCxcbiAgICAgICAgICAgIHBsYWNlaG9sZGVyczogY3VzdG9tT3B0aW9ucy5wbGFjZWhvbGRlcnMgIT09IHVuZGVmaW5lZCA/IGN1c3RvbU9wdGlvbnMucGxhY2Vob2xkZXJzIDogdGhpcy5vcHRpb25zLnBsYWNlaG9sZGVycyxcbiAgICAgICAgICAgIHF1aWV0OiBjdXN0b21PcHRpb25zLnF1aWV0ICE9PSB1bmRlZmluZWQgPyBjdXN0b21PcHRpb25zLnF1aWV0IDogdGhpcy5vcHRpb25zLnF1aWV0LFxuICAgICAgICAgICAgdHJhbnNwb3J0czogY3VzdG9tT3B0aW9ucy50cmFuc3BvcnRzICE9PSB1bmRlZmluZWQgPyBjdXN0b21PcHRpb25zLnRyYW5zcG9ydHMgOiB0aGlzLm9wdGlvbnMudHJhbnNwb3J0cyxcbiAgICAgICAgICAgIGN1c3RvbUZ1bmN0aW9uczogY3VzdG9tT3B0aW9ucy5jdXN0b21GdW5jdGlvbnMgIT09IHVuZGVmaW5lZCA/IGN1c3RvbU9wdGlvbnMuY3VzdG9tRnVuY3Rpb25zIDogdGhpcy5vcHRpb25zLmN1c3RvbUZ1bmN0aW9ucyxcbiAgICAgICAgICAgIGxvZ1R5cGU6IGN1c3RvbU9wdGlvbnMubG9nVHlwZSAhPT0gdW5kZWZpbmVkID8gY3VzdG9tT3B0aW9ucy5sb2dUeXBlIDogdGhpcy5vcHRpb25zLmxvZ1R5cGUsXG4gICAgICAgICAgICBsb2dTdGFjazogY3VzdG9tT3B0aW9ucy5sb2dTdGFjayAhPT0gdW5kZWZpbmVkID8gY3VzdG9tT3B0aW9ucy5sb2dTdGFjayA6IHRoaXMub3B0aW9ucy5sb2dTdGFjayxcbiAgICAgICAgfTtcbiAgICB9XG4gICAgY3VzdG9tKGN1c3RvbU9wdGlvbnMsIHNldEludGVybmFscywgbWVzc2FnZSkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgLy8gc2V0b3B0aW9uc1xuICAgICAgICAgICAgbGV0IG9wdCA9IHRoaXMubWVyZ2VPcHRpb25zKGN1c3RvbU9wdGlvbnMpO1xuICAgICAgICAgICAgLy8gc2V0IG5ldyBJbnRlcm5hbHZhbHVlc1xuICAgICAgICAgICAgZm9yIChsZXQga2V5IGluIHNldEludGVybmFscykge1xuICAgICAgICAgICAgICAgIHRoaXMuaW50ZXJuYWxzW2tleV0gPSBzZXRJbnRlcm5hbHNba2V5XTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGdlbmVyYXRlIHN0cmluZ1xuICAgICAgICAgICAgbGV0IHN0ciA9IGAke29wdC5wcmVmaXh9JHttZXNzYWdlfSR7b3B0LnBvc3RmaXh9YDtcbiAgICAgICAgICAgIHN0ciA9IHJlcGxhY2VDb21wbGV4KCh0aGlzLm9wdGlvbnMucGxhY2Vob2xkZXJzIHx8IFtdKSwgc3RyLCB0aGlzLmludGVybmFscyk7XG4gICAgICAgICAgICBsZXQgYXN5bmNUaGluZ3MgPSBbXTtcbiAgICAgICAgICAgIC8vIGFkZCB0cmFuc3BvcnRzXG4gICAgICAgICAgICBmb3IgKGxldCB0cmFuc3BvcnQgb2Ygb3B0LnRyYW5zcG9ydHMgfHwgW10pIHtcbiAgICAgICAgICAgICAgICBhc3luY1RoaW5ncy5wdXNoKHRyYW5zcG9ydC5leGVjKHRoaXMuaW50ZXJuYWxzLCBzdHIpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZvciAobGV0IGFzeW5jRXhlYyBvZiBvcHQuY3VzdG9tRnVuY3Rpb25zIHx8IFtdKSB7XG4gICAgICAgICAgICAgICAgYXN5bmNUaGluZ3MucHVzaChhc3luY0V4ZWMoc3RyLCB0aGlzLmludGVybmFscywgb3B0KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB5aWVsZCBQcm9taXNlLmFsbChhc3luY1RoaW5ncyk7XG4gICAgICAgICAgICAvLyBjaGVjayBcbiAgICAgICAgICAgIGlmICghb3B0LnF1aWV0ICYmIChjb25zb2xlW29wdC5sb2dUeXBlIHx8ICdsb2cnXSAhPT0gdW5kZWZpbmVkKSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGVbb3B0LmxvZ1R5cGUgfHwgJ2xvZyddKHN0cik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gc3RyO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgO1xuICAgIGxvZyhzdHIsIGN1c3RvbU9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCB0aGlzLmN1c3RvbShjdXN0b21PcHRpb25zIHx8IHt9LCB7IHNlcnZpY2U6ICdMT0cnIH0sIHN0cik7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBlcnJvcihlcnJvciwgY3VzdG9tT3B0aW9ucykge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgbGV0IG9wdCA9IHRoaXMubWVyZ2VPcHRpb25zKGN1c3RvbU9wdGlvbnMgfHwge30pO1xuICAgICAgICAgICAgLy8gc2V0IGxvZ3R5cGUgdG8gZXJyb3IgLT4gY29uc29sZS5lcnJvcihzdHIpXG4gICAgICAgICAgICBvcHQubG9nVHlwZSA9ICdlcnJvcic7XG4gICAgICAgICAgICBsZXQgc3RyID0gZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGAke2Vycm9yLm1lc3NhZ2V9JHsob3B0LmxvZ1N0YWNrICYmIGVycm9yLnN0YWNrICE9PSB1bmRlZmluZWQpID8gJ1xcbicgKyBlcnJvci5zdGFjayA6ICcnfWAgOiBlcnJvcjtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCB0aGlzLmN1c3RvbShvcHQsIHsgc2VydmljZTogJ0VSUk9SJyB9LCBzdHIpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG4iLCJ2YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHJlc3VsdC52YWx1ZSk7IH0pLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbmltcG9ydCB7IExvZ1VwVHMgfSBmcm9tICcuL2xvZ3VwdHMnO1xuZGVzY3JpYmUoJ3Rlc3QnLCAoKSA9PiB7XG4gICAgaXQoJ2xvZyB0byBjb25zb2xlIHdpdGhvdXQgVHJhbnNwb3J0IGFuZCBjdXN0b21GdW5jdGlvbnMnLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGxldCBsb2dnZXIgPSBuZXcgTG9nVXBUcyh7IHF1aWV0OiB0cnVlIH0pO1xuICAgICAgICBsZXQgbCA9IHlpZWxkIGxvZ2dlci5sb2coJ2hlbGxvJyk7XG4gICAgICAgIGV4cGVjdChsKS50b0VxdWFsKCdbTE9HXSBoZWxsbycpO1xuICAgICAgICAvLyBjaGFuZ2UgcHJlZml4IHRvIGEgdGltZXN0YW1wXG4gICAgICAgIGxvZ2dlci5vcHRpb25zLnByZWZpeCA9ICd7e3llYXJ9fSAnO1xuICAgICAgICBsID0geWllbGQgbG9nZ2VyLmxvZygnaGVsbG8nKTtcbiAgICAgICAgZXhwZWN0KGwpLnRvRXF1YWwoJzIwMTggaGVsbG8nKTtcbiAgICB9KSk7XG4gICAgaXQoJ2xvZyBlcnJvciB0byBjb25zb2xlIHdpdGhvdXQgVHJhbnNwb3J0IGFuZCBjdXN0b21GdW5jdGlvbnMnLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGxldCBsb2dnZXIgPSBuZXcgTG9nVXBUcyh7IHF1aWV0OiB0cnVlLCBsb2dTdGFjazogZmFsc2UgfSk7XG4gICAgICAgIGxldCBsID0geWllbGQgbG9nZ2VyLmVycm9yKG5ldyBFcnJvcignYSBFcnJvciBoYXBwZW5kJykpO1xuICAgICAgICBleHBlY3QobCkudG9FcXVhbCgnRXJyb3InKTtcbiAgICB9KSk7XG59KTtcbiIsImV4cG9ydCBmdW5jdGlvbiByZXBsYWNlU2luZ2xlKGtleSwgc3RyaW5nLCByZXBsYWNlQ29udGVudCwgZmxhZ3MsIHBhc3NBcmd1bWVudHMpIHtcbiAgICAvLyBzZXQgZGVmYXVsdCBmbGFnc1xuICAgIGZsYWdzID0gZmxhZ3MgfHwgJ2cnO1xuICAgIC8vIGNyZWF0ZSBSZWdleFxuICAgIGxldCByZWdleCA9IG5ldyBSZWdFeHAoa2V5LCBmbGFncyk7XG4gICAgbGV0IHJlcztcbiAgICBsZXQgY291bnRlciA9IDA7XG4gICAgd2hpbGUgKChyZXMgPSByZWdleC5leGVjKHN0cmluZy5zbGljZShjb3VudGVyKSkpICE9PSBudWxsKSB7XG4gICAgICAgIGtleSA9IGtleS5yZXBsYWNlKChuZXcgUmVnRXhwKCdcXFxcXFxcXCcsICdnJykpLCAnJyk7XG4gICAgICAgIHN0cmluZyA9IHN0cmluZy5yZXBsYWNlKGtleSwgdHlwZW9mIHJlcGxhY2VDb250ZW50ID09PSAnZnVuY3Rpb24nID8gcmVwbGFjZUNvbnRlbnQoJycsIHBhc3NBcmd1bWVudHMpIDogcmVwbGFjZUNvbnRlbnQpO1xuICAgICAgICArK2NvdW50ZXI7XG4gICAgfVxuICAgIHJldHVybiBzdHJpbmc7XG59XG47XG5leHBvcnQgZnVuY3Rpb24gcmVwbGFjZUNvbXBsZXgoY29tcGxleEtleXMsIHN0cmluZywgcGFzc0FyZ3VtZW50cykge1xuICAgIGZvciAobGV0IGNvbXBsZXggb2YgY29tcGxleEtleXMpIHtcbiAgICAgICAgLy8gc2luZ2xlIGtleSBwbGFjZWhvbGRlcnNcbiAgICAgICAgaWYgKGNvbXBsZXgua2V5c1sxXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBzdHJpbmcgPSBjb21wbGV4LmNhbGxlZCAhPT0gdHJ1ZSA/IHJlcGxhY2VTaW5nbGUoY29tcGxleC5rZXlzWzBdLCBzdHJpbmcsIChhcmdzLCB0b1Bhc3MpID0+IHsgcmV0dXJuIGNvbXBsZXgucmVwbGFjZXIoJycsIHRvUGFzcyk7IH0sIGNvbXBsZXguZmxhZ3MsIHBhc3NBcmd1bWVudHMpIDogc3RyaW5nO1xuICAgICAgICB9XG4gICAgICAgIC8vIDIga2V5IHBsYWNlaG9sZGVyc1xuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGxldCBtYXhJbmRleCA9IC0xO1xuICAgICAgICAgICAgZm9yIChsZXQgaW5Db21wbGV4IG9mIGNvbXBsZXhLZXlzKSB7XG4gICAgICAgICAgICAgICAgLy8gY3JlYXRlIFJlZ3VsYXIgZXhwcmVzc2lvblxuICAgICAgICAgICAgICAgIGxldCByZWdleCA9IG5ldyBSZWdFeHAoaW5Db21wbGV4LmtleXNbMF0sIGluQ29tcGxleC5mbGFncyk7XG4gICAgICAgICAgICAgICAgbGV0IHJlcyA9IHJlZ2V4LmV4ZWMoc3RyaW5nKTtcbiAgICAgICAgICAgICAgICBpZiAocmVzICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIG1heEluZGV4ID0gbWF4SW5kZXggPCByZXMuaW5kZXggPyByZXMuaW5kZXggOiBtYXhJbmRleDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobWF4SW5kZXggPiAwKSB7XG4gICAgICAgICAgICAgICAgc3RyaW5nID0gc3RyaW5nLnNsaWNlKDAsIG1heEluZGV4KSArIHJlcGxhY2VDb21wbGV4KGNvbXBsZXhLZXlzLCBzdHJpbmcuc2xpY2UobWF4SW5kZXgpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIHNlYXJjaCBpbmRleCB3aGVyZSBwYXR0ZXJuIGlzIGZpcnN0IHRpbWVcbiAgICAgICAgICAgIGxldCByZWdleCA9IG5ldyBSZWdFeHAoY29tcGxleC5rZXlzWzBdLCBjb21wbGV4LmZsYWdzKTtcbiAgICAgICAgICAgIGxldCByZXMxID0gcmVnZXguZXhlYyhzdHJpbmcpO1xuICAgICAgICAgICAgaWYgKHJlczEgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAvLyBmaW5kIGNsb3NpbmcgcGF0dGVybiBpbiBzdHJpbmdcbiAgICAgICAgICAgICAgICByZWdleCA9IG5ldyBSZWdFeHAoY29tcGxleC5rZXlzWzFdLCBjb21wbGV4LmZsYWdzKTtcbiAgICAgICAgICAgICAgICBsZXQgcmVzMiA9IHJlZ2V4LmV4ZWMoc3RyaW5nKTtcbiAgICAgICAgICAgICAgICBsZXQgcmVtb3ZlRXNjYXBlc0Zyb21LZXlzID0gW2NvbXBsZXgua2V5c1swXS5yZXBsYWNlKChuZXcgUmVnRXhwKCdcXFxcXFxcXCcsICdnJykpLCAnJyksIGNvbXBsZXgua2V5c1sxXS5yZXBsYWNlKChuZXcgUmVnRXhwKCdcXFxcXFxcXCcsICdnJykpLCAnJyldO1xuICAgICAgICAgICAgICAgIGlmIChyZXMyICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGNyZWF0ZSBuZXcgc3RyaW5nXG4gICAgICAgICAgICAgICAgICAgIHN0cmluZyA9IHN0cmluZy5zbGljZSgwLCByZXMxLmluZGV4KSArIGNvbXBsZXgucmVwbGFjZXIoc3RyaW5nLnNsaWNlKHJlczEuaW5kZXggKyByZW1vdmVFc2NhcGVzRnJvbUtleXNbMF0ubGVuZ3RoLCByZXMyLmluZGV4KSwgcGFzc0FyZ3VtZW50cykgKyBzdHJpbmcuc2xpY2UocmVzMi5pbmRleCArIHJlbW92ZUVzY2FwZXNGcm9tS2V5c1sxXS5sZW5ndGgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gc3RyaW5nO1xufVxuIl0sInNvdXJjZVJvb3QiOiIifQ==